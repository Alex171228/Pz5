# Практическое занятие №5  
## Шишков Алексей Дмитриевич ЭФМО-02-21
## Тема
Подключение к PostgreSQL через database/sql. Выполнение простых запросов (INSERT, SELECT)
## Цели
1.	Установить и настроить PostgreSQL локально.
2.	Подключиться к БД из Go с помощью database/sql и драйвера PostgreSQL.
3.	Выполнить параметризованные запросы INSERT и SELECT.
4.	Корректно работать с context, пулом соединений и обработкой ошибок.
## Структура проекта

<img width="279" height="213" alt="изображение" src="https://github.com/user-attachments/assets/7f17c0c0-d6f5-4eb9-80f0-f9af08416776" /> 

## Установка и настройка
1. **На сервере Ubuntu:**
   - Установить PostgreSQL (`sudo apt install postgresql`).
   - Создать БД `todo` и пользователь `myuser`.
   - Разрешить подключение с внешнего IP (`listen_addresses='*'`, `pg_hba.conf`).
   - Открыть порт `5432` в UFW.
   - Создать таблица `tasks`:

2. **На локальной машине:**
   - Установить Go 1.21.
   - Клонировать проект и настроить `.env`
   - Установить зависимости:
     ```powershell
     go mod tidy
     ```

3. **Запуск:**
   ```powershell
   go run .

## Результаты работы
Создание базы данных (в данном случае она уже быда создана до этого)

<img width="506" height="88" alt="изображение" src="https://github.com/user-attachments/assets/33258b11-3431-44fc-9d2f-8ca7769cd1f1" /> 

Проверка её наличия

<img width="1391" height="67" alt="изображение" src="https://github.com/user-attachments/assets/9581faec-e0c6-4b87-9925-9e1543c5d80e" /> 

Успешный вывод go run 

<img width="800" height="925" alt="изображение" src="https://github.com/user-attachments/assets/5f44d424-cb8f-4e2d-aa29-c074234af2f7" /> 

Вывод таблицы tasks

<img width="781" height="601" alt="изображение" src="https://github.com/user-attachments/assets/2a5cf260-b2a5-4457-ba46-04bdeffb958e" />


## Краткие ответы
1. Что такое пул соединений *sql.DB и зачем его настраивать?

*sql.DB — это не одно подключение, а менеджер пула соединений.
Он:

- управляет набором активных подключений к БД,

- переиспользует их для ускорения работы,

- ограничивает одновременное количество соединений,

- предотвращает перегрузку базы данных.

Настройки пула (SetMaxOpenConns, SetMaxIdleConns, SetConnMaxLifetime) помогают обеспечить стабильную работу приложения и оптимальное использование ресурсов.

2. Почему используем плейсхолдеры $1, $2?

- Безопасность: защита от SQL-инъекций — значения передаются отдельно от текста запроса.

- Надёжность: драйвер сам корректно экранирует значения.

- Производительность: драйвер может использовать подготовленные запросы.

- Конкатенация SQL-строк вручную небезопасна.
3. Чем отличаются Query, QueryRow и Exec?
Query	Выполнение запроса, который возвращает несколько строк	*Rows (обход через Next())
QueryRow	Выполнение запроса, который возвращает одну строку	Row (чтение через Scan)
Exec	Выполнение запроса без данных (INSERT, UPDATE и т.д.)	Result (количество изменений)

## Обоснование транзакций и настроек пула
Зачем нужны транзакции

Транзакции позволяют сгруппировать несколько операций в одно атомарное действие:

- если что-то не выполнено — откат всех изменений;

- обеспечивают целостность данных;

- удобны для массовых вставок и обновлений.

В проекте это реализовано в функции CreateMany: если вставка одной задачи не удалась — транзакция откатывается целиком.
## Почему выбраны такие настройки пула
- db.SetMaxOpenConns(10) - максимум 10 соединений 
- db.SetMaxIdleConns(5) - до 5 неактивных соединений 
- db.SetConnMaxLifetime(30 * time.Minute) - срок жизни соединения 


10 соединений достаточно для учебной/локальной нагрузки.

Idle-соединения ускоряют повторные запросы.

Lifetime обновляет соединения, чтобы избежать зависаний.

 В продакшене эти параметры подбираются под нагрузку и характеристики сервера, а для учебного стенда этого более чем достаточно.

